# Build context must be edda root (parent of nidhoggr) for path deps: context: .., dockerfile: nidhoggr/Dockerfile.test
FROM rust:1.75-slim

WORKDIR /app

# Install dependencies for building
RUN apt-get update && apt-get install -y \
    pkg-config \
    libssl-dev \
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/*

# Copy path deps and proto sources; nidhoggr build.rs uses ../nornen/proto etc
COPY ratatoskr ./ratatoskr
COPY nornen ./nornen
COPY heidrun ./heidrun
COPY mimir ./mimir
COPY nidhoggr ./nidhoggr

WORKDIR /app/nidhoggr

RUN cargo build --release

CMD ["cargo", "test", "--release"]
